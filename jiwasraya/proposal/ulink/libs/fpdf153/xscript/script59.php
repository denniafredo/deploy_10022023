<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<TITLE>Extraction of PDF properties</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../fpdf.css">
</HEAD>
<BODY ONLOAD="if(window.focus) window.focus()">
<H2>Extraction of PDF properties</H2>
<H4 CLASS="st">Informations</H4>Author: Sacha MPS<BR>License: Freeware
<H4 CLASS="st">Description</H4>This function extracts the document properties from a PDF file. It works fine with documents
generated by FPDF. It can also work with PDFs made from other generators, but not all.<BR>
<BR>
The <TT>get_pdf_prop()</TT> function returns an associative array whose keys are the names of
the properties found in the file (such as Author, CreationDate, Creator, Keywords, Producer,
Subject and Title).
<H4 CLASS="st">Source</H4><TABLE WIDTH="100%" STYLE="color:#4040C0; border-style:ridge" BORDERCOLORLIGHT="#B0B0E0" BORDERCOLORDARK="#000000" BORDER="2" CELLPADDING=6 CELLSPACING=0 BGCOLOR="#F0F5FF"><TR><TD style="border-width:0px">
<NOBR><code><font color="#000000">
&lt;?php<br><font class="kw">function </font>get_pdf_prop<font class="kw">(</font>$file<font class="kw">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$f <font class="kw">= </font>fopen<font class="kw">(</font>$file<font class="kw">,</font><font class="str">'rb'</font><font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;if(!</font>$f<font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font>false<font class="kw">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Read the last 16KB<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>fseek<font class="kw">(</font>$f<font class="kw">, -</font>16384<font class="kw">, </font>SEEK_END<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$s <font class="kw">= </font>fread<font class="kw">(</font>$f<font class="kw">, </font>16384<font class="kw">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Extract cross-reference table and trailer<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>preg_match<font class="kw">(</font><font class="str">"/xref[\r\n](.*)trailer(.*)startxref/s"</font><font class="kw">, </font>$s<font class="kw">, </font>$a<font class="kw">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font>false<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$xref <font class="kw">= </font>$a<font class="kw">[</font>1<font class="kw">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$trailer <font class="kw">= </font>$a<font class="kw">[</font>2<font class="kw">];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Extract Info object number<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>preg_match<font class="kw">(</font><font class="str">'/Info ([0-9]+) /'</font><font class="kw">, </font>$trailer<font class="kw">, </font>$a<font class="kw">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font>false<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$object_no <font class="kw">= </font>$a<font class="kw">[</font>1<font class="kw">];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Extract Info object offset<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$lines <font class="kw">= </font>split<font class="kw">(</font><font class="str">"[\r\n]"</font><font class="kw">, </font>$xref<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$line <font class="kw">= </font>$lines<font class="kw">[</font>1 <font class="kw">+ </font>$object_no<font class="kw">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$offset <font class="kw">= (int)</font>$line<font class="kw">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Read Info object<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>fseek<font class="kw">(</font>$f<font class="kw">, </font>$offset<font class="kw">, </font>SEEK_SET<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$s <font class="kw">= </font>fread<font class="kw">(</font>$f<font class="kw">, </font>1024<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>fclose<font class="kw">(</font>$f<font class="kw">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Extract properties<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>preg_match<font class="kw">(</font><font class="str">'/&lt;&lt;(.*)&gt;&gt;/Us'</font><font class="kw">, </font>$s<font class="kw">, </font>$a<font class="kw">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font>false<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$n <font class="kw">= </font>preg_match_all<font class="kw">(</font><font class="str">'|/([a-z]+) ?\((.*)\)|Ui'</font><font class="kw">, </font>$a<font class="kw">[</font>1<font class="kw">], </font>$a<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$prop <font class="kw">= array();<br>&nbsp;&nbsp;&nbsp;&nbsp;for(</font>$i<font class="kw">=</font>0<font class="kw">; </font>$i<font class="kw">&lt;</font>$n<font class="kw">; </font>$i<font class="kw">++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$prop<font class="kw">[</font>$a<font class="kw">[</font>1<font class="kw">][</font>$i<font class="kw">]] = </font>$a<font class="kw">[</font>2<font class="kw">][</font>$i<font class="kw">];<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font>$prop<font class="kw">;<br>}<br></font>?&gt;
</font>
</code></NOBR></TD></TR></TABLE>

<H4 CLASS="st">Download</H4><A HREF="script59.zip">ZIP</A> | <A HREF="script59.tgz">TGZ</A>
</BODY>
</HTML>
