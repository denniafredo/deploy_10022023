<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<TITLE>MySQL report</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../fpdf.css">
</HEAD>
<BODY ONLOAD="if(window.focus) window.focus()">
<H2>MySQL report</H2>
<H4 CLASS="st">Informations</H4>Author: <SCRIPT TYPE="text/javascript">document.write('<A H'+'REF="m'+'ailto:nod'+'&#'+'64;'+'bouncing.org?subject=MySQL%20report">');</SCRIPT>Philip Clarke<SCRIPT TYPE="text/javascript">document.write('<\/A>');</SCRIPT><BR>License: Freeware
<H4 CLASS="st">Description</H4>This script is a variation on the <A HREF="http://www.fpdf.org/?go=script&id=12" TARGET="_blank">Table with multi-page columns</A>.
The difference is that when a query is executed initially the php loops through, gathers the
string widths and then resizes the columns to try and fit everything onto the page. If a column
never uses the maximum width alloted to it, the column is sized down and the saved space is
re-assigned to the other columns. The aim of this was to be able to get out a good looking mysql
report using as few a lines as possible, the disadvantage is that because the query has
to loop through the results to work out the column sizes, it takes a bit of time. To
counteract this, there is a dump option, that dumps out the php required to set up column
widths, so one could check with a small report that the columns looked okay, then apply
the dumped column widths to a larger report.
<H4 CLASS="st">Source</H4><TABLE WIDTH="100%" STYLE="color:#4040C0; border-style:ridge" BORDERCOLORLIGHT="#B0B0E0" BORDERCOLORDARK="#000000" BORDER="2" CELLPADDING=6 CELLSPACING=0 BGCOLOR="#F0F5FF"><TR><TD style="border-width:0px">
<NOBR><code><font color="#000000">
&lt;?php<br>define<font class="kw">(</font>FPDF_FONTPATH<font class="kw">,</font><font class="str">'font/'</font><font class="kw">);<br>require(</font><font class="str">'fpdf.php'</font><font class="kw">);<br><br>class </font>PDF <font class="kw">extends </font>FPDF <font class="kw">{<br><br>var </font>$tablewidths<font class="kw">;<br>var </font>$headerset<font class="kw">;<br>var </font>$footerset<font class="kw">;<br><br>function </font>_beginpage<font class="kw">(</font>$orientation<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page<font class="kw">++;<br>&nbsp;&nbsp;&nbsp;&nbsp;if(!</font>$<font class="kw">this-&gt;</font>pages<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">]) </font><font class="cmt">// solved the problem of overwriting a page, if it already exists<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>pages<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">]=</font><font class="str">''</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>state<font class="kw">=</font>2<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>x<font class="kw">=</font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>y<font class="kw">=</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>lasth<font class="kw">=</font>0<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>FontFamily<font class="kw">=</font><font class="str">''</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Page orientation<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>$orientation<font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$orientation<font class="kw">=</font>$<font class="kw">this-&gt;</font>DefOrientation<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$orientation<font class="kw">=</font>strtoupper<font class="kw">(</font>$orientation<font class="kw">{</font>0<font class="kw">});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</font>$orientation<font class="kw">!=</font>$<font class="kw">this-&gt;</font>DefOrientation<font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>OrientationChanges<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">]=</font>true<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;if(</font>$orientation<font class="kw">!=</font>$<font class="kw">this-&gt;</font>CurOrientation<font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Change orientation<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(</font>$orientation<font class="kw">==</font><font class="str">'P'</font><font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>wPt<font class="kw">=</font>$<font class="kw">this-&gt;</font>fwPt<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>hPt<font class="kw">=</font>$<font class="kw">this-&gt;</font>fhPt<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>w<font class="kw">=</font>$<font class="kw">this-&gt;</font>fw<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>h<font class="kw">=</font>$<font class="kw">this-&gt;</font>fh<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>wPt<font class="kw">=</font>$<font class="kw">this-&gt;</font>fhPt<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>hPt<font class="kw">=</font>$<font class="kw">this-&gt;</font>fwPt<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>w<font class="kw">=</font>$<font class="kw">this-&gt;</font>fh<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>h<font class="kw">=</font>$<font class="kw">this-&gt;</font>fw<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>PageBreakTrigger<font class="kw">=</font>$<font class="kw">this-&gt;</font>h<font class="kw">-</font>$<font class="kw">this-&gt;</font>bMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>CurOrientation<font class="kw">=</font>$orientation<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>function </font>Header<font class="kw">()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;global </font>$maxY<font class="kw">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// Check if header for this page already exists<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>$<font class="kw">this-&gt;</font>headerset<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">]) {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$<font class="kw">this-&gt;</font>tablewidths <font class="kw">as </font>$width<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$fullwidth <font class="kw">+= </font>$width<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetY<font class="kw">((</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">) - (</font>$<font class="kw">this-&gt;</font>FontSizePt<font class="kw">/</font>$<font class="kw">this-&gt;</font>k<font class="kw">)*</font>2<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>cellFontSize <font class="kw">= </font>$<font class="kw">this-&gt;</font>FontSizePt <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetFont<font class="kw">(</font><font class="str">'Arial'</font><font class="kw">,</font><font class="str">''</font><font class="kw">,( ( </font>$<font class="kw">this-&gt;</font>titleFontSize<font class="kw">) ? </font>$<font class="kw">this-&gt;</font>titleFontSize <font class="kw">: </font>$<font class="kw">this-&gt;</font>FontSizePt <font class="kw">));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Cell<font class="kw">(</font>0<font class="kw">,</font>$<font class="kw">this-&gt;</font>FontSizePt<font class="kw">,</font>$<font class="kw">this-&gt;</font>titleText<font class="kw">,</font>0<font class="kw">,</font>1<font class="kw">,</font><font class="str">'C'</font><font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">= (</font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetFont<font class="kw">(</font><font class="str">'Arial'</font><font class="kw">,</font><font class="str">''</font><font class="kw">,</font>$<font class="kw">this-&gt;</font>cellFontSize<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$<font class="kw">this-&gt;</font>colTitles <font class="kw">as </font>$col <font class="kw">=&gt; </font>$txt<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetXY<font class="kw">(</font>$l<font class="kw">,(</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>MultiCell<font class="kw">(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">], </font>$<font class="kw">this-&gt;</font>FontSizePt<font class="kw">,</font>$txt<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">+= </font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">] ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$maxY <font class="kw">= (</font>$maxY <font class="kw">&lt; </font>$<font class="kw">this-&gt;</font>getY<font class="kw">()) ? </font>$<font class="kw">this-&gt;</font>getY<font class="kw">() : </font>$maxY <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetXY<font class="kw">(</font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">,</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>setFillColor<font class="kw">(</font>200<font class="kw">,</font>200<font class="kw">,</font>200<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">= (</font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$<font class="kw">this-&gt;</font>colTitles <font class="kw">as </font>$col <font class="kw">=&gt; </font>$txt<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetXY<font class="kw">(</font>$l<font class="kw">,</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>cell<font class="kw">(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">],</font>$maxY<font class="kw">-(</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">),</font><font class="str">''</font><font class="kw">,</font>1<font class="kw">,</font>0<font class="kw">,</font><font class="str">'L'</font><font class="kw">,</font>1<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetXY<font class="kw">(</font>$l<font class="kw">,</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>MultiCell<font class="kw">(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">],</font>$<font class="kw">this-&gt;</font>FontSizePt<font class="kw">,</font>$txt<font class="kw">,</font>0<font class="kw">,</font><font class="str">'C'</font><font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">+= </font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>setFillColor<font class="kw">(</font>255<font class="kw">,</font>255<font class="kw">,</font>255<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set headerset<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>headerset<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">] = </font>1<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetY<font class="kw">(</font>$maxY<font class="kw">);<br>}<br><br>function </font>Footer<font class="kw">() {<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// Check if footer for this page already exists<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!</font>$<font class="kw">this-&gt;</font>footerset<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">]) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetY<font class="kw">(-</font>15<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">//Page number<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Cell<font class="kw">(</font>0<font class="kw">,</font>10<font class="kw">,</font><font class="str">'Page '</font><font class="kw">.</font>$<font class="kw">this-&gt;</font>PageNo<font class="kw">().</font><font class="str">'/{nb}'</font><font class="kw">,</font>0<font class="kw">,</font>0<font class="kw">,</font><font class="str">'C'</font><font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set footerset<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>footerset<font class="kw">[</font>$<font class="kw">this-&gt;</font>page<font class="kw">] = </font>1<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>function </font>morepagestable<font class="kw">(</font>$lineheight<font class="kw">=</font>8<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// some things to set and 'remember'<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">= </font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$startheight <font class="kw">= </font>$h <font class="kw">= </font>$<font class="kw">this-&gt;</font>GetY<font class="kw">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$startpage <font class="kw">= </font>$currpage <font class="kw">= </font>$<font class="kw">this-&gt;</font>page<font class="kw">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// calculate the whole width<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">foreach(</font>$<font class="kw">this-&gt;</font>tablewidths <font class="kw">as </font>$width<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$fullwidth <font class="kw">+= </font>$width<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// Now let's start to write the table<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$row <font class="kw">= </font>0<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;while(</font>$data<font class="kw">=</font>mysql_fetch_row<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page <font class="kw">= </font>$currpage<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// write the horizontal borders<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Line<font class="kw">(</font>$l<font class="kw">,</font>$h<font class="kw">,</font>$fullwidth<font class="kw">+</font>$l<font class="kw">,</font>$h<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// write the content and remember the height of the highest col<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">foreach(</font>$data <font class="kw">as </font>$col <font class="kw">=&gt; </font>$txt<font class="kw">) {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page <font class="kw">= </font>$currpage<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>SetXY<font class="kw">(</font>$l<font class="kw">,</font>$h<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>MultiCell<font class="kw">(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">],</font>$lineheight<font class="kw">,</font>$txt<font class="kw">,</font>0<font class="kw">,</font>$<font class="kw">this-&gt;</font>colAlign<font class="kw">[</font>$col<font class="kw">]);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">+= </font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$col<font class="kw">];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</font>$tmpheight<font class="kw">[</font>$row<font class="kw">.</font><font class="str">'-'</font><font class="kw">.</font>$<font class="kw">this-&gt;</font>page<font class="kw">] &lt; </font>$<font class="kw">this-&gt;</font>GetY<font class="kw">()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$tmpheight<font class="kw">[</font>$row<font class="kw">.</font><font class="str">'-'</font><font class="kw">.</font>$<font class="kw">this-&gt;</font>page<font class="kw">] = </font>$<font class="kw">this-&gt;</font>GetY<font class="kw">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</font>$<font class="kw">this-&gt;</font>page <font class="kw">&gt; </font>$maxpage<font class="kw">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$maxpage <font class="kw">= </font>$<font class="kw">this-&gt;</font>page<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</font>$data<font class="kw">[</font>$col<font class="kw">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// get the height we were in the last used page<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$h <font class="kw">= </font>$tmpheight<font class="kw">[</font>$row<font class="kw">.</font><font class="str">'-'</font><font class="kw">.</font>$maxpage<font class="kw">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set the "pointer" to the left margin<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">= </font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set the $currpage to the last page<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$currpage <font class="kw">= </font>$maxpage<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</font>$data<font class="kw">[</font>$row<font class="kw">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$row<font class="kw">++ ;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// draw the borders<br>&nbsp;&nbsp;&nbsp;&nbsp;// we start adding a horizontal line on the last page<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page <font class="kw">= </font>$maxpage<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Line<font class="kw">(</font>$l<font class="kw">,</font>$h<font class="kw">,</font>$fullwidth<font class="kw">+</font>$l<font class="kw">,</font>$h<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// now we start at the top of the document and walk down<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">for(</font>$i <font class="kw">= </font>$startpage<font class="kw">; </font>$i <font class="kw">&lt;= </font>$maxpage<font class="kw">; </font>$i<font class="kw">++) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page <font class="kw">= </font>$i<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">= </font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$t <font class="kw">= (</font>$i <font class="kw">== </font>$startpage<font class="kw">) ? </font>$startheight <font class="kw">: </font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$lh <font class="kw">= (</font>$i <font class="kw">== </font>$maxpage<font class="kw">) ? </font>$h <font class="kw">: </font>$<font class="kw">this-&gt;</font>h<font class="kw">-</font>$<font class="kw">this-&gt;</font>bMargin<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Line<font class="kw">(</font>$l<font class="kw">,</font>$t<font class="kw">,</font>$l<font class="kw">,</font>$lh<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$<font class="kw">this-&gt;</font>tablewidths <font class="kw">as </font>$width<font class="kw">) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$l <font class="kw">+= </font>$width<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Line<font class="kw">(</font>$l<font class="kw">,</font>$t<font class="kw">,</font>$l<font class="kw">,</font>$lh<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set it to the last page, if not it'll cause some problems<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>page <font class="kw">= </font>$maxpage<font class="kw">;<br>}<br><br>function </font>connect<font class="kw">(</font>$host<font class="kw">=</font><font class="str">'localhost'</font><font class="kw">,</font>$username<font class="kw">=</font><font class="str">''</font><font class="kw">,</font>$password<font class="kw">=</font><font class="str">''</font><font class="kw">,</font>$db<font class="kw">=</font><font class="str">''</font><font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>conn <font class="kw">= </font>mysql_connect<font class="kw">(</font>$host<font class="kw">,</font>$username<font class="kw">,</font>$password<font class="kw">) or die( </font>mysql_error<font class="kw">() );<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>mysql_select_db<font class="kw">(</font>$db<font class="kw">,</font>$<font class="kw">this-&gt;</font>conn<font class="kw">) or die( </font>mysql_error<font class="kw">() );<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font>true<font class="kw">;<br>}<br><br>function </font>query<font class="kw">(</font>$query<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>results <font class="kw">= </font>mysql_query<font class="kw">(</font>$query<font class="kw">,</font>$<font class="kw">this-&gt;</font>conn<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>numFields <font class="kw">= </font>mysql_num_fields<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">);<br>}<br><br>function </font>mysql_report<font class="kw">(</font>$query<font class="kw">,</font>$dump<font class="kw">=</font>false<font class="kw">,</font>$attr<font class="kw">=array()){<br><br>&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$attr <font class="kw">as </font>$key<font class="kw">=&gt;</font>$val<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>$key <font class="kw">= </font>$val <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>query<font class="kw">(</font>$query<font class="kw">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// if column widths not set<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if(!isset(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">)){<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// starting col width<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>sColWidth <font class="kw">= ((</font>$<font class="kw">this-&gt;</font>w<font class="kw">-</font>$<font class="kw">this-&gt;</font>lMargin<font class="kw">-</font>$<font class="kw">this-&gt;</font>rMargin<font class="kw">))/</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// loop through results header and set initial col widths/ titles/ alignment<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if a col title is less than the starting col width / reduce that column size<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$stringWidth <font class="kw">= </font>$<font class="kw">this-&gt;</font>getstringwidth<font class="kw">(</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">)) + </font>6 <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( (</font>$stringWidth<font class="kw">) &lt; </font>$<font class="kw">this-&gt;</font>sColWidth<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$colFits<font class="kw">[</font>$i<font class="kw">] = </font>$stringWidth <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set any column titles less than the start width to the column title width<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colTitles<font class="kw">[</font>$i<font class="kw">] = </font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">) ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (</font>mysql_field_type<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">)){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </font><font class="str">'int'</font><font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colAlign<font class="kw">[</font>$i<font class="kw">] = </font><font class="str">'R'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colAlign<font class="kw">[</font>$i<font class="kw">] = </font><font class="str">'L'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// loop through the data, any column whose contents is bigger that the col size is<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// resized<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">while(</font>$row<font class="kw">=</font>mysql_fetch_row<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">)){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$colFits <font class="kw">as </font>$key<font class="kw">=&gt;</font>$val<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$stringWidth <font class="kw">= </font>$<font class="kw">this-&gt;</font>getstringwidth<font class="kw">(</font>$row<font class="kw">[</font>$key<font class="kw">]) + </font>6 <font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( (</font>$stringWidth<font class="kw">) &gt; </font>$<font class="kw">this-&gt;</font>sColWidth <font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// any col where row is bigger than the start width is now discarded<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">unset(</font>$colFits<font class="kw">[</font>$key<font class="kw">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// if text is not bigger than the current column width setting enlarge the column<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">if( (</font>$stringWidth<font class="kw">) &gt; </font>$val <font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$colFits<font class="kw">[</font>$key<font class="kw">] = (</font>$stringWidth<font class="kw">) ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</font>$colFits <font class="kw">as </font>$key<font class="kw">=&gt;</font>$val<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// set fitted columns to smallest size<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$key<font class="kw">] = </font>$val<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="cmt">// to work out how much (if any) space has been freed up<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$totAlreadyFitted <font class="kw">+= </font>$val<font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$surplus <font class="kw">= (</font>sizeof<font class="kw">(</font>$colFits<font class="kw">)*</font>$<font class="kw">this-&gt;</font>sColWidth<font class="kw">) - (</font>$totAlreadyFitted<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!</font>in_array<font class="kw">(</font>$i<font class="kw">,</font>array_keys<font class="kw">(</font>$colFits<font class="kw">))){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$i<font class="kw">] = </font>$<font class="kw">this-&gt;</font>sColWidth <font class="kw">+ (</font>$surplus<font class="kw">/((</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">)-</font>sizeof<font class="kw">(</font>$colFits<font class="kw">)));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>ksort<font class="kw">(</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</font>$dump<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>Header<font class="kw">(</font><font class="str">'Content-type: text/plain'</font><font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</font>strlen<font class="kw">(</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">))&gt;</font>$flength<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$flength <font class="kw">= </font>strlen<font class="kw">(</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(</font>$<font class="kw">this-&gt;</font>k<font class="kw">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </font>72<font class="kw">/</font>25.4<font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$unit <font class="kw">= </font><font class="str">'millimeters'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </font>72<font class="kw">/</font>2.54<font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$unit <font class="kw">= </font><font class="str">'centimeters'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </font>72<font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$unit <font class="kw">= </font><font class="str">'inches'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$unit <font class="kw">= </font><font class="str">'points'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font><font class="str">"All measurements in $unit</font><font class="kw">\n\n</font><font class="str">"</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>printf<font class="kw">(</font><font class="str">"%-</font><font class="kw">{</font><font class="str">$flength</font><font class="kw">}</font><font class="str">s : %-10s : %10f</font><font class="kw">\n</font><font class="str">"</font><font class="kw">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>mysql_field_type<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$i<font class="kw">] );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font><font class="str">"\n\n"</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font><font class="str">"\$pdf-&gt;tablewidths=\n\tarray(\n\t\t"</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</font>$i<font class="kw">&lt;(</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">-</font>1<font class="kw">)) ?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$i<font class="kw">].</font><font class="str">", /* "</font><font class="kw">.</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">).</font><font class="str">" */\n\t\t"</font><font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font>$<font class="kw">this-&gt;</font>tablewidths<font class="kw">[</font>$i<font class="kw">].</font><font class="str">" /* "</font><font class="kw">.</font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">).</font><font class="str">" */\n\t\t"</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </font><font class="str">"\n\t);\n"</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;} else { </font><font class="cmt">// end of if tablewidths not defined<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font class="kw">for(</font>$i<font class="kw">=</font>0<font class="kw">;</font>$i<font class="kw">&lt;</font>$<font class="kw">this-&gt;</font>numFields<font class="kw">;</font>$i<font class="kw">++){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colTitles<font class="kw">[</font>$i<font class="kw">] = </font>mysql_field_name<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">) ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (</font>mysql_field_type<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>$i<font class="kw">)){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </font><font class="str">'int'</font><font class="kw">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colAlign<font class="kw">[</font>$i<font class="kw">] = </font><font class="str">'R'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>colAlign<font class="kw">[</font>$i<font class="kw">] = </font><font class="str">'L'</font><font class="kw">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font>mysql_data_seek<font class="kw">(</font>$<font class="kw">this-&gt;</font>results<font class="kw">,</font>0<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Open<font class="kw">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>setY<font class="kw">(</font>$<font class="kw">this-&gt;</font>tMargin<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>AddPage<font class="kw">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>morepagestable<font class="kw">(</font>$<font class="kw">this-&gt;</font>FontSizePt<font class="kw">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font>$<font class="kw">this-&gt;</font>Output<font class="kw">();<br>}<br><br>}<br><br></font>$pdf <font class="kw">= new </font>PDF<font class="kw">(</font><font class="str">'L'</font><font class="kw">,</font><font class="str">'pt'</font><font class="kw">,</font><font class="str">'A3'</font><font class="kw">);<br></font>$pdf<font class="kw">-&gt;</font>SetFont<font class="kw">(</font><font class="str">'Arial'</font><font class="kw">,</font><font class="str">''</font><font class="kw">,</font>11.5<font class="kw">);<br></font>$pdf<font class="kw">-&gt;</font>AliasNbPages<font class="kw">();<br></font>$pdf<font class="kw">-&gt;</font>connect<font class="kw">(</font><font class="str">'localhost'</font><font class="kw">,</font><font class="str">'root'</font><font class="kw">,</font><font class="str">''</font><font class="kw">,</font><font class="str">'register'</font><font class="kw">);<br></font>$attr<font class="kw">=array(</font><font class="str">'titleFontSize'</font><font class="kw">=&gt;</font>18<font class="kw">,</font><font class="str">'titleText'</font><font class="kw">=&gt;</font><font class="str">'this would be the title'</font><font class="kw">);<br></font>$pdf<font class="kw">-&gt;</font>mysql_report<font class="kw">(</font><font class="str">"SELECT * FROM registered_users ORDER BY USER LIMIT 100"</font><font class="kw">,</font>false<font class="kw">,</font>$attr<font class="kw">);<br></font>?&gt;
</font>
</code></NOBR></TD></TR></TABLE>
<BR>
View the result <A HREF="mysql_report.pdf" TARGET="_blank">here</A>.
<H4 CLASS="st">Download</H4><A HREF="script21.zip">ZIP</A> | <A HREF="script21.tgz">TGZ</A>
</BODY>
</HTML>
